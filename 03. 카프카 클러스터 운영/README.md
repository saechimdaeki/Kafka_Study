# 카프카 클러스터 운영

## 아파치 카프카 클러스터를 운영하는 방법

![image](https://user-images.githubusercontent.com/40031858/170489966-e0eb8929-aa27-4393-9e9c-9a55264a535d.png)

`SaaS`란 클라우드 서비스 제공업체가 소프트웨어와 인프라를 관리하면서 플랫폼을 제공하는 것을 뜻한다.

사용자는 웹 대시보드나 CLI를 통해 플랫폼의 세부 설정을 간편하게 할 수 있으며 네트워크, 스토리지, 가상화 등 다양한 종류의 운영상 이슈는 업체에서 관리하기 때문에 매우 편리하다

![image](https://user-images.githubusercontent.com/40031858/170490268-a63674e4-5512-4804-9659-b2d4c74ed63e.png)

![image](https://user-images.githubusercontent.com/40031858/170490326-4bbff423-db53-4786-be55-d0edd29fc1bc.png)

---

## SaaS형 아파치 카프카 소개

### 클라우드 서비스 - 컨플루언트 클라우드, 컨플루언트 플랫폼
|||
|:--:|:--:|
|`컨플루언트 클라우드`|`컨플루언트 플랫폼`|
|- 클라우드 기반 카프카 클러스터 <br/> - 요구사항에 따라 자동으로 늘려주는 클러스터 리소스 제공 <br/> - GCP, AWS등 클러스터 설치 위치 지정(리전 단위) 가능 <br/> - 120개가 넘는 커넥터, ksqlDB, 스키마 레지스트리 서비스 제공 <br/> - 99.95% SLA <br/> - 엔터프라이즈 수준의 보안 수준 제공 <br/> - 데이터 적재 제한 없음|- 온프레미스 기반 설치형 카프카 클러스터 <br/> - 서버를 내부에서 발급하여 직접 설치 <br/> - 필요에 따라 컨플루언트 팀에서 지원, 학습 제공 <br/> - 단계별 스토리지 기능(Tiered-storage) 제공 <br/> - GUI기반 모니터링 시스템 제공|

### 클라우드 서비스 - AWS MSK
MSK는 AWS에서 제공하는 SaaS형 아파치 카프카 서비스이다. AWS MSK는 AWS 인프라에서 카프카 클러스터를 생성, 업데이트, 삭제 등과 같은 운영 요소를 대시보드를 통해 제공한다.

또한, 안전하게 접속할 수 있도록 클러스터와 연동시 TLS 인증 보안을 설정할 수 있다. MSK로 클러스터를 생성하고자 하는 엔지니어는 아파치 카프카 버전을 직접 선택할 수 있다.

그렇기 때문에 기존에 카프카 클라이언트를 운영하고 있는 기업은 버전차이에 이ㅡ한 연동 이슈를 발생시키지 않을 수 있다는 장점이 있다.


----

## SaaS형 아파치 카프카 장점과 단점

### SaaS로 카프카 클러스터를 운영할 경우 장점
`인프라 관리의 효율화`

카프카 클러스터는 상용환경에서 최소 3대 이상의 서버로 운영한다. 클러스터를 담당하고 운영하는 개발자의 입장에서는 3대 이상의 서버를 모니터링해야 한다는 것인데, SaaS를 사용할 경우

인프라 운영 관련 역할에서 자유로울 수 있다. 왜냐하면 카프카 SaaS서비스를 사용하게 되면 브로커가 올라가는 서버는 자동으로 관리되기 때문이다. 만약 브로커들 중 일부에 이슈가 발생하여

서버를 재시작하는 상황이 일어나더라도 카프카 운영자는 크게 신경 쓸 일이 없다. 왜냐하면 SaaS서비스가 이슈를 감지하여

이슈가 생긴 서버를 제외하고 신규 장비에 브로커를 실행하여 클러스터를 복구하기 때문이다. 클러스터의 데이터 사용량이 순간적으로 많아지더라도

서비스를 제공하는 업체의 SaaS 대시보드에서 브로커 개수만 설정하여 쉽게 스케일아웃할 수 있다.

`모니터링 대시보드 제공`

카프카 클러스터를 직접 설치한다고해서 카프카를 잘 활용할 수 있는 것은 아니다. 브로커들이 제공하는 지표들을 수집하고 적재하고

대시보드화하여 데이터를 시각화해야 카프카 클러스터를 효과적으로 운영하기 위해 필요한 설정들을 수정하고 적용할 수 있기 때문이다. 막상 카프카 클러스터를 설치하고 나면

어떤 지표들을 수집해야 할지 막막하다. 또한, 수집을 시작하고 나면 적재된 지표가 너무 많기 떄문에 어떤 것이 중요한지 알아가는데에도 시간이 걸린다.

SaaS형 카프카에서는 자동화되어 만들어진 클러스터로부터 운영에 필요한 지표들을 수집하고 그래프로 보여주는 옵션이 제공된다. 만약 직접 카프카 클러스터를 운영했다면 수집한

지표를 저장할 저장소를 구축하고 대시보드를 운영하기 위해 신규로 추가 플랫폼을 설치 운영해야한다.

`보안 설정`
보안 설정이 되지 않은 카프카 클러스터는 자물쇠가 달리지 않은 외양간과 같다. 보안이 설정 되지않은 클러스터의 경우 호스트와 포트 번호만

알면 모든 토픽의 데이터를 가져갈 수 있다. 카프카 브로커는 SSL, SASL , ACL과 같이 불특정 다수의 침입을 막기 위해 다양한 종류의 보안 설정 방안을 제공하고 있다.

그러나 어떤 종류의 보안 설정을 할지 고르고 설정, 운영하는것은 쉬운일이 아니다. 이점을 보완하기 위해 SaaS형 카프카에서는

클러스터 접속시 보안설정을 기본으로 제공하고 있다.

### Saas로 카프카 클러스터를 운영할 경우 단점
`서비스 사용 비용`

카프카 클러스터를 직접 설치하고 운영한다면 브로커를 실행하는 서버의 사용 비용만 들이면 된다. 그러나 SaaS형 카프카를 사용하려면 특정요금제를 사용해야한다.

보통 직접 서버를 발급하여 설치하고 운영하는 것이 AWS MSK를 사용한느 것에 비해 2배 이상 저렴하다.

`커스텀마이징의 제한`

카프카 클러스터를 직접 운영하다 보면 서버의 최적화 옵션이나 카프카 브로커 옵션 같은 다양한 부분에서 사용자 설정들이 들어간다.

그러나 SaaS 서비스들은 인프라부터 애플리케이션 설치까지 모든 부분이 자동화되어 있고 업체에서 설정한 아키텍쳐를 따라가기 때문에 상세한 설정을

적용하거나 클러스터 아키텍쳐의 변화가 필요할경우 적용하기 매우 어렵다. 특히 멀티클라우드나 하이브리드 클라우드 형태로 카프카 클러스터를

구성하는 것은 SaaS형 카프카에서는 불가능하다.

`클라우드의 종속성`

SaaS형 카프카를 구축하기 위해선느 클라우드 서비스 업체를 선택하고 클러스터를 운영해야 한다. 클라우드 서비스 업체를 선택하고 클러스터를 운영하는 순간 프로듀서,

컨슈머들을 포함한 클러스터와 관련된 모든 애플리케이션은 해당 서비스에 종속된다. 한번 선택한 SaaS형 카프카를 중단하지 않고 한개의 서비스 업체에서 지속적으로

운영하는게 가장 좋은 방법이지만 현실에서는 다양한 이슈가 발생한다. 비용적으로 더 나은 SaaS서비스 업체가 생길 수도 있고 카프카 운영상 추가 기능이 필요하여

클러스터의 데이터와 연동을 온프레미스로 옮겨야 할 수도 있다. 클라우드 종속성을 탈피하기 위해서는 멀티 클라우드 또는 하이브리드 클라우드를 도입하는

방법이 있지만 Saas형 카프카를 사용할 경우에는 멀티클라우드, 하이브리드 클라우드 적용이 불가능하다.