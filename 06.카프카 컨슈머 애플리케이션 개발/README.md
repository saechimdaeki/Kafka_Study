# 카프카 컨슈머 애플리케이션 개발

## 컨슈머 그룹

![image](https://user-images.githubusercontent.com/40031858/172273441-0910aac1-485e-4ddf-a852-3e65906d4408.png)

컨슈머 그룹으로 운영하는 방법은 컨슈머를 각 컨슈머 그룹으로부터 격리된 환경에서 안전하게 운영할수 있도록 도와주는 카프카의 독특한 방식이다.

컨슈머 그룹으로 묶인 컨슈머들은 토픽의 1개 이상 파티션들에 할당되어 데이터를 가져갈 수 있다. 컨슈머 그룹으로 묶인 컨슈머가 토픽을 구독해서 데이터를 가져갈 때, 1개의 파티션은

최대 1개의 컨슈머에 할당 가능하다. 그리고 1개 컨슈머는 여러개의 파티션에 할당될 수 있다. 이러한 특징으로 컨슈머 그룹의 컨슈머 개수는

가져가고자 하는 토픽의 파티션 개수보다 같거나 작아야 함.

### 컨슈머 그룹의 컨슈머가 파티션 개수보다 많을 경우 

![image](https://user-images.githubusercontent.com/40031858/172273611-5036f08e-879f-4bff-ae49-bdf6892739bb.png)

만약 4개의 컨슈머로 이루어진 컨슈머 그룹으로 3개의 파티션을 가진 토픽에서 데이터를 가져가기 위해 할당하면 1개의 컨슈머는 파티션을 할당받지 못하고 유휴상태로 남게된다.

즉, 스레드만 차지하고 데이터처리를 못하므로 불필요한 스레드이다.

### 컨슈머 그룹의 컨슈머가 파티션 개수보다 많을 경우

![image](https://user-images.githubusercontent.com/40031858/172273767-f4f96a4c-8d56-4a3c-9cac-cf2eb38530c6.png)

카프카는 이러한 파이프라인을 운영함에 있어 최종 적재되는 저장소의 장애에 유연하게 대응할 수 있도록 각기 다른 저장소에 저장하는 컨슈머를 다른 컨슈머 그룹으로

묶음으로써 각 저장소의 장애에 격리되어 운영할 수 있다. 따라서 엘라스틱서치의 장애로 인해 더는 적재가 되지 못하더라도 하둡으로 데이터를 적재

하는데에는 문제가 없다. 엘라스틱서치의 장애가 해소되면 엘라스틱 서치로 적재하는 컨슈머의 컨슈머 그룹은 마지막으로 적재 완료한 데이터 이후부터 다시 적재를 수행하여 최종적으로 모두 정상화될 것이다.